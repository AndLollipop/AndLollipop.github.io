<!doctype html>
<html class="theme-next use-motion theme-next-mala">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<style>
    .pace .pace-progress {
        background: #1E92FB; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*上边框颜色*/
        border-left-color: #1E92FB;    /*左边框颜色*/
    }
</style>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>




<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.1"/>


    <meta name="description" content="我思故我在" />



  <meta name="keywords" content="Camera开发," />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.1" />


<meta name="description" content="前言&amp;emsp;&amp;emsp; 上一次分析了Camera的基本使用，并且使用实现了基本的预览功能，在上一次我们提到了使用setDisplayOrientation() 设置相机的预览方向，还有看上一节分享的预览图可以发现图像被拉伸了。那我们这一节不要讲解下如何控制方向和尺寸的问题。 Camera 中的方向&amp;emsp;&amp;emsp;在相机开发中有三个方向的定义：屏幕方向、图像传感器方向、拍照后的照片方">
<meta name="keywords" content="Camera开发">
<meta property="og:type" content="article">
<meta property="og:title" content="Camera之[方向与尺寸]">
<meta property="og:url" content="http://andlollipop.github.io/2018/01/23/20180120_Camera方向和尺寸适配/index.html">
<meta property="og:site_name" content="花花世界博客">
<meta property="og:description" content="前言&amp;emsp;&amp;emsp; 上一次分析了Camera的基本使用，并且使用实现了基本的预览功能，在上一次我们提到了使用setDisplayOrientation() 设置相机的预览方向，还有看上一节分享的预览图可以发现图像被拉伸了。那我们这一节不要讲解下如何控制方向和尺寸的问题。 Camera 中的方向&amp;emsp;&amp;emsp;在相机开发中有三个方向的定义：屏幕方向、图像传感器方向、拍照后的照片方">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://oa5504rxk.bkt.clouddn.com/week17_camera/2.png">
<meta property="og:image" content="http://oa5504rxk.bkt.clouddn.com/week17_camera/3.png">
<meta property="og:image" content="http://oa5504rxk.bkt.clouddn.com/week17_camera/4.png">
<meta property="og:image" content="http://p1chajscf.bkt.clouddn.com/5.png">
<meta property="og:updated_time" content="2018-03-14T02:25:33.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Camera之[方向与尺寸]">
<meta name="twitter:description" content="前言&amp;emsp;&amp;emsp; 上一次分析了Camera的基本使用，并且使用实现了基本的预览功能，在上一次我们提到了使用setDisplayOrientation() 设置相机的预览方向，还有看上一节分享的预览图可以发现图像被拉伸了。那我们这一节不要讲解下如何控制方向和尺寸的问题。 Camera 中的方向&amp;emsp;&amp;emsp;在相机开发中有三个方向的定义：屏幕方向、图像传感器方向、拍照后的照片方">
<meta name="twitter:image" content="http://oa5504rxk.bkt.clouddn.com/week17_camera/2.png">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mala',
    sidebar: 'hide'
  };
</script>

  <title> Camera之[方向与尺寸] | 花花世界博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  



  <div class="container one-column page-post-detail">
    <div class="headband"></div>
<a href="https://www.andly.vip"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/567c3a48d796e2fc06ea80409cc9dd82bf714434/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub"
 data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_darkblue_121621.png"></a>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-next-logo"></i>
      </span>
      <span class="site-title">逗比的小码农</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-next-home"></i> <br />
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            <i class="menu-item-icon icon-next-categories"></i> <br />
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-next-archives"></i> <br />
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-next-tags"></i> <br />
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            <i class="menu-item-icon icon-next-about"></i> <br />
            关于
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 

  <div id="posts" class="posts-expand">
    

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              Camera之[方向与尺寸]
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2018-01-23T23:18:00+08:00" content="2018-01-23">
            2018-01-23
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/技术周/" itemprop="url" rel="index">
                  <span itemprop="name">技术周</span>
                </a>
              </span>

              
              
                ， 
              

            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/技术周/Camera开发/" itemprop="url" rel="index">
                  <span itemprop="name">Camera开发</span>
                </a>
              </span>

              
              

            

            &nbsp; | &nbsp; 作者:
            
              <span itemprop="author" itemscope itemtype="https://schema.org/Thing">
                  <span itemprop="author">花</span>
              </span>

            
              <span itemprop="author" itemscope itemtype="https://schema.org/Thing">
                  <span itemprop="author">花</span>
              </span>

            

          </span>
        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        <span itemprop="articleBody"><script src="/assets/js/APlayer.min.js"> </script><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>&emsp;&emsp; 上一次分析了Camera的基本使用，并且使用实现了基本的预览功能，在上一次我们提到了使用setDisplayOrientation() 设置相机的预览方向，还有看上一节分享的预览图可以发现图像被拉伸了。那我们这一节不要讲解下如何控制方向和尺寸的问题。</p>
<h3 id="Camera-中的方向"><a href="#Camera-中的方向" class="headerlink" title="Camera 中的方向"></a>Camera 中的方向</h3><p>&emsp;&emsp;在相机开发中有三个方向的定义：屏幕方向、图像传感器方向、拍照后的照片方向。在开发时，我们要确保这三个方向保持一致，这样我们才能预览以及拍出我们想看到的照片。</p>
<p><strong>屏幕方向  图像传感器方向</strong><br>&emsp;&emsp;屏幕方向我们应该都不陌生，就是以屏幕左上角为原点，横向为X轴正方向，纵向为Y轴正方向。而相机的图像传感器方向是由安装的Image Sensor决定的，在多数的手机中后置相机的图像传感器的方向是以屏幕右上角为原点，纵向为X的正方向，横向为Y轴的正方向。</p>
<p><img src="http://oa5504rxk.bkt.clouddn.com/week17_camera/2.png" alt=""></p>
<p>对于横屏应用来说，屏幕的方向和绘制摄像头图像传感器方向一致，所以看到的图像是正方向的</p>
<p><img src="http://oa5504rxk.bkt.clouddn.com/week17_camera/3.png" alt=""></p>
<p>而当屏幕竖直方向时，屏幕方向和图像传感器方向不一致，这是我们看到的图像就是这样的</p>
<p><img src="http://oa5504rxk.bkt.clouddn.com/week17_camera/4.png" alt=""></p>
<p>不知道大家刚刚开始看到图像时是否会感觉很奇怪，结合上面的坐标系，这个小人的脑袋不是应该朝向右面吗,如果是这样呢，那我就很高兴找到一个同盟，哈哈。但是后来经过事实验证小人的脑袋确实是朝向左面的，于是经过各种理解终于找到了一种说服自己的方法，这种方法可能不权威，但是还是想说一下：首先从上面的图中我们可以看到屏幕的和图像传感器有90度的夹角，当图像传感器采集到图像后会以某种方式映射到屏幕上的，这种方式就是逆时针旋转90度，因为只有这样两个坐标系才是对应的，然后再说图像传感器所生产的图像应该就我们所看到的物体的方向，也就是小人脑袋是朝上的，映射到屏幕上逆时针旋转90度后，我们便看到了上图所示的图像。</p>
<p>对于前置摄像头一般是和后置摄像头成180度的，但是前置摄像头采集的图像是经过镜像处理显示在屏幕上的，所以对于前置摄像头我们也是旋转90所以对于前置摄像头我们也是旋转90就可以正确的预览图像了</p>
<p><img src="http://p1chajscf.bkt.clouddn.com/5.png" alt=""></p>
<p>所以我们现在要使用setDisplayOrientation()来设置图片显示的方向和屏幕方向一致，Android 官网提供了一种设置图片预览方向和屏幕方向一致的设置操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setCameraDisplayOrientation</span><span class="params">(Activity activity,</span></span></span><br><span class="line"><span class="function"><span class="params">         <span class="keyword">int</span> cameraId, android.hardware.Camera camera)</span> </span>&#123;</span><br><span class="line">     android.hardware.Camera.CameraInfo info =</span><br><span class="line">             <span class="keyword">new</span> android.hardware.Camera.CameraInfo();</span><br><span class="line">     android.hardware.Camera.getCameraInfo(cameraId, info);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//获取屏幕的方向</span></span><br><span class="line">     <span class="keyword">int</span> rotation = activity.getWindowManager().getDefaultDisplay()</span><br><span class="line">             .getRotation();</span><br><span class="line">     <span class="keyword">int</span> degrees = <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">switch</span> (rotation) &#123;</span><br><span class="line">         <span class="keyword">case</span> Surface.ROTATION_0: degrees = <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">         <span class="keyword">case</span> Surface.ROTATION_90: degrees = <span class="number">90</span>; <span class="keyword">break</span>;</span><br><span class="line">         <span class="keyword">case</span> Surface.ROTATION_180: degrees = <span class="number">180</span>; <span class="keyword">break</span>;</span><br><span class="line">         <span class="keyword">case</span> Surface.ROTATION_270: degrees = <span class="number">270</span>; <span class="keyword">break</span>;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">int</span> result;</span><br><span class="line">     <span class="keyword">if</span> (info.facing == Camera.CameraInfo.CAMERA_FACING_FRONT) &#123;</span><br><span class="line">         <span class="comment">//前置摄像头</span></span><br><span class="line">         result = (info.orientation + degrees) % <span class="number">360</span>;</span><br><span class="line">         result = (<span class="number">360</span> - result) % <span class="number">360</span>;  <span class="comment">// compensate the mirror</span></span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;  <span class="comment">// back-facing</span></span><br><span class="line">       <span class="comment">//后置摄像头</span></span><br><span class="line">         result = (info.orientation - degrees + <span class="number">360</span>) % <span class="number">360</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     camera.setDisplayOrientation(result);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>CameraInfo 是获取相机信息的API，官方是这样解释的：Information about a camera</p>
<p>cameraInfo.orientation:  The orientation of the camera image. The value is the angle that the camera image needs to be rotated clockwise so it shows correctly on the display in its natural orientation. It should be 0, 90, 180, or 270. 意思是说图像显示自然方向需要顺时针旋转的角度</p>
<blockquote>
<p>(以上的图片引自一下网站 ：<a href="https://www.cnblogs.com/bugly/p/6108758.html，这篇文章总结的很好的，如果觉得我上面讲的不好可以看看这篇文章）" target="_blank" rel="noopener">https://www.cnblogs.com/bugly/p/6108758.html，这篇文章总结的很好的，如果觉得我上面讲的不好可以看看这篇文章）</a></p>
</blockquote>
<p><strong>手机传感器方向  照片方向</strong><br>&emsp;&emsp;在设置好预览方向后，我们进行拍照，查看拍好的照片我们会发现拍摄的照片方向并不对，刚刚费了那么大的力气弄明白了预览方向的设置，发现其拍摄的照片方向并不生效，是不是很气，不过生气也没有办法啦，还得乖乖的来研究下怎么把拍摄好的照片方向整好才是。</p>
<p>在android api 中看setDisplayOrientation()时，对该方法有这样一句注解：This does not affect the order of byte array passed in onPreviewFrame(byte[], Camera), JPEG pictures, or recorded videos。 意思就是说不会调用onPreviewFrame 方法生成的JPEG图像，或者录制的视频产生作用。因此我们必须使用另外的方法来设置生成的照片的方向了。</p>
<p>首先获取到相机的设置服务类Camera.Parameters,这个类主要用于设置相机的显示效果，该类中会有setXXX方法供我们设置我们想要的效果，但是在这之前我们必须通过getXXX获取此效果允许我们设置的参数，如果我们设置了系统不支持的尺寸会发生不好的事情的（崩溃），设置好之后我们还要通过camera.setParameters(..)方法使我们上面设置的参数生效。</p>
<p>在Camera.Parameters中系统提供了设置照片方向的方法：setRotation (int rotation)：</p>
<p>Sets the clockwise rotation angle in degrees relative to the orientation of the camera. This affects the pictures returned from JPEG Camera.PictureCallback. The camera driver may set orientation in the EXIF header without rotating the picture. Or the driver may rotate the picture and the EXIF thumbnail. If the Jpeg picture is rotated, the orientation in the EXIF header will be missing or 1 (row #0 is top and column #0 is left side).</p>
<p>If applications want to rotate the picture to match the orientation of what users see, apps should use OrientationEventListener and Camera.CameraInfo. The value from OrientationEventListener is relative to the natural orientation of the device. CameraInfo.orientation is the angle between camera orientation and natural device orientation. The sum of the two is the rotation angle for back-facing camera. The difference of the two is the rotation angle for front-facing camera. Note that the JPEG pictures of front-facing cameras are not mirrored as in preview display.</p>
<p>For example, suppose the natural orientation of the device is portrait. The device is rotated 270 degrees clockwise, so the device orientation is 270. Suppose a back-facing camera sensor is mounted in landscape and the top side of the camera sensor is aligned with the right edge of the display in natural orientation. So the camera orientation is 90. The rotation should be set to 0 (270 + 90).</p>
<p>并且官方还给我们提供了获取图片该设置的角度的方法，以下是官方给出的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOrientationChanged</span><span class="params">(<span class="keyword">int</span> orientation)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (orientation == ORIENTATION_UNKNOWN) <span class="keyword">return</span>;</span><br><span class="line">     android.hardware.Camera.CameraInfo info =</span><br><span class="line">            <span class="keyword">new</span> android.hardware.Camera.CameraInfo();</span><br><span class="line">     android.hardware.Camera.getCameraInfo(cameraId, info);</span><br><span class="line">     orientation = (orientation + <span class="number">45</span>) / <span class="number">90</span> * <span class="number">90</span>;</span><br><span class="line">     <span class="keyword">int</span> rotation = <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">if</span> (info.facing == CameraInfo.CAMERA_FACING_FRONT) &#123;</span><br><span class="line">         rotation = (info.orientation - orientation + <span class="number">360</span>) % <span class="number">360</span>;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;  <span class="comment">// back-facing camera</span></span><br><span class="line">         rotation = (info.orientation + orientation) % <span class="number">360</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     mParameters.setRotation(rotation);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>其中onOrientationChanged(int orientation)是OrientationEventListener中的回调方法，OrientationEventListener是监测手机（不是屏幕哦）旋转了多少度的，onOrientationChanged 中的orientation是指手机顺时针旋转的角度。<br>通过以上计算后给相机设置计算后的角度，这个角度一定是0,90,180,270中的一个。</p>
<p>最后把相机的服务类设置给相机：camera.setParameters(mParameters);</p>
<blockquote>
<p>一定要设置否则设置的参数将不会生效。</p>
</blockquote>
<p>好了，通过以上解说我们解决了相机中的方向的问题，接下来我们聊一下相机中的尺寸问题。</p>
<h3 id="Camera-中的尺寸问题"><a href="#Camera-中的尺寸问题" class="headerlink" title="Camera 中的尺寸问题"></a>Camera 中的尺寸问题</h3><p>&emsp;&emsp;开发相机时我们要保证<strong>预览控件的尺寸、图像预览的尺寸、照片的尺寸</strong> 的比例必须一致，否则我们不是看到在预览时界面有拉伸就是拍出来的照片有拉伸的问题。在相机中最常用到的预览比例是16:9和4:3,在我们确定了要设置的比例后分别通过设置该比例控件的大小、camera的预览尺寸和照片的大小后，就可以实现正常的预览和拍摄正常图片的功能了。</p>
<blockquote>
<p>设置控件的尺寸可以通过在自定义view中重写onMeasure方法设置，下面给出一种设置预览控件大小的写法</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        super.onMeasure(widthMeasureSpec, heightMeasureSpec);</span></span><br><span class="line">          <span class="keyword">int</span> previewWidth = MeasureSpec.getSize(widthMeasureSpec);</span><br><span class="line">          <span class="keyword">int</span> previewHeight = MeasureSpec.getSize(heightMeasureSpec);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">boolean</span> widthLonger = previewWidth &gt; previewHeight?<span class="keyword">true</span>:<span class="keyword">false</span>;</span><br><span class="line">          <span class="keyword">int</span> longSide =  (widthLonger ?previewWidth : previewHeight);</span><br><span class="line">          <span class="keyword">int</span> shortSide = (widthLonger ? previewHeight : previewWidth);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (Math.abs((mRatio - (<span class="number">16</span> / <span class="number">9</span>d))) &lt; Util.DEVIATION)&#123;</span><br><span class="line">              Log.d(TAG, <span class="string">"onMeasure: 16:9"</span>);</span><br><span class="line">              <span class="keyword">if</span> (longSide &lt; shortSide*mRatio)&#123;</span><br><span class="line">                  longSide = Math.round((<span class="keyword">float</span>) (shortSide * mRatio) / <span class="number">2</span>)* <span class="number">2</span>;</span><br><span class="line">              &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                  shortSide = Math.round((<span class="keyword">float</span>) (previewHeight / mRatio) / <span class="number">2</span>) * <span class="number">2</span>;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">             Log.d(TAG, <span class="string">"onMeasure: 4:3"</span>);</span><br><span class="line">             <span class="keyword">if</span> (longSide &gt; shortSide * mRatio)&#123;</span><br><span class="line">                 longSide = Math.round((<span class="keyword">float</span>) (shortSide * mRatio) / <span class="number">2</span>) * <span class="number">2</span>;</span><br><span class="line">             &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                 shortSide = Math.round((<span class="keyword">float</span>) (previewHeight / mRatio) / <span class="number">2</span>) * <span class="number">2</span>;</span><br><span class="line">             &#125;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (widthLonger)&#123;</span><br><span class="line">              previewWidth = longSide;</span><br><span class="line">              previewHeight = shortSide;</span><br><span class="line">          &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">              previewHeight = longSide;</span><br><span class="line">              previewWidth = shortSide;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">int</span> marginTop = getResources().getDimensionPixelOffset(R.dimen.surface_margin_top);</span><br><span class="line">          FrameLayout.LayoutParams params = (FrameLayout.LayoutParams) getLayoutParams();</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (mRatio &lt; Util.FULL_SCREEN)&#123;</span><br><span class="line">             params.setMargins(<span class="number">0</span>,marginTop,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">          &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">             params.setMargins(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          setLayoutParams(params);</span><br><span class="line"></span><br><span class="line">          setMeasuredDimension(previewWidth,previewHeight);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRatio</span><span class="params">(<span class="keyword">double</span> ratio)</span></span>&#123;</span><br><span class="line">        Log.d(TAG, <span class="string">"setRatio: ratio = "</span>+ratio);</span><br><span class="line">        <span class="keyword">if</span> (mRatio != ratio)&#123;</span><br><span class="line">            mRatio = ratio;</span><br><span class="line">            requestLayout();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>接下来我们要设置相机的预览尺寸和照片尺寸了，</p>
<p><strong>获取Parameters</strong><br><code>mCamera.getParameters()</code></p>
<p><strong>设置预览大小和图片大小</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPreviewSize</span><span class="params">(<span class="keyword">double</span> ratio)</span></span>&#123;</span><br><span class="line">        Camera.Size previewSize = getAppropriateSize(mParameters.getSupportedPreviewSizes(),ratio);</span><br><span class="line">        Log.d(TAG, <span class="string">"setPreviewSize: preview width = "</span>+previewSize.width+<span class="string">"; height = "</span>+previewSize.height);</span><br><span class="line">        mParameters.setPreviewSize(previewSize.width,previewSize.height);</span><br><span class="line"></span><br><span class="line">        Camera.Size picSize = getAppropriateSize(mParameters.getSupportedPictureSizes(),ratio);</span><br><span class="line">        Log.d(TAG, <span class="string">"setPreviewSize: pic width = "</span>+previewSize.width+<span class="string">"; height = "</span>+previewSize.height);</span><br><span class="line">        mParameters.setPictureSize(picSize.width,picSize.height);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//这里只是简单的筛选了适合比例的尺寸，自己写时可以使用更加严谨的筛选规则，</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Camera.<span class="function">Size <span class="title">getAppropriateSize</span><span class="params">(List&lt;Camera.Size&gt; sizeList,<span class="keyword">double</span> ratio)</span></span>&#123;</span><br><span class="line">        Camera.Size result = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (Camera.Size size:sizeList)&#123;</span><br><span class="line">            <span class="keyword">if</span> (Math.abs(ratio - size.width *<span class="number">1.0</span>d / size.height) &lt; DEVIATION)&#123;</span><br><span class="line">                result = size;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Log.d(TAG, <span class="string">"getPreviewSize: ratio = "</span>+ratio+<span class="string">"; result width = "</span>+result.width+<span class="string">"; height = "</span>+result.height);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>将设置好参数的Parameters 设置给相机</strong><br><code>mCamera.setParameters(mParameters);</code></p>
<p>结合上面方向的设置，我们就可以实现方向正确自定义比例的的照片了。</p>
<p>自己写了一个小demo供大家参考：</p>
<p><a href="https://github.com/AndLollipop/huahua_Camera/tree/master/huahua_Camera_02" target="_blank" rel="noopener">https://github.com/AndLollipop/huahua_Camera/tree/master/huahua_Camera_02</a></p>
<p>在下一篇中会继续讲解相机中聚焦和人脸识别的实现，请继续关注哦。</p>
</span>
      
    </div>
	
	<div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束，<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
  
	</div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Camera开发/" rel="tag">#Camera开发</a>
          
        </div>
      
	  

      
        <div class="post-nav">
          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/01/24/20180124_点滴面试经(Android篇)/" rel="prev">点滴面试经(Android篇)</a>
            
          </div>

          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/01/13/20180113_ConstraintSet完全解析/" rel="next">ConstraintSet完全解析</a>
            
          </div>
		  
        </div>
      
	  


      
      
    </footer>
  </article>



    <div>
      
        <style type="text/css">

    .donate_bar {
        text-align: center;
        margin-top : 5%;
    }

    .donate_bar.hidden {
        display:none;
    }
/*
    .donate_bar a.btn_donate {
        display: inline-block;
        width: 82px;
        height: 82px;
        margin-left:auto;
        margin-right:auto;

        background: url("http://img.t.sinajs.cn/t5/style/images/apps_PRF/e_media/btn_reward.gif") no-repeat;
        _background: url("http://img.t.sinajs.cn/t5/style/images/apps_PRF/e_media/btn_reward.gif") no-repeat; 

        -webkit-transition: background 0s;
        -moz-transition: background 0s;
        -o-transition: background 0s;
        -ms-transition: background 0s;
        transition: background 0s;
    }
*/
    .donate_bar a.btn_donate:hover { 
        // background-position: 0px -82px;
        color: #87daff;
    }

    .donate_bar .donate_txt {
        display: block;
        color: #9d9d9d;
        font: 14px/2 "Microsoft Yahei";
    }

    .bold { 
        font-weight: bold; 
    }

    .post-donate a {
        border-bottom: 0px;
    }

    #donate_guide table {
        border: none;
    }

    #donate_guide td {
        border-bottom: none;
        border-right: none;
        // background: #333333;
        valign: top;
    }

</style>



    

    <div class ="post-donate">
        <div id="donate_board" class="donate_bar center">
              <a id="btn_donate" class="btn_donate" href="javascript:;" title="打赏">赏</a>
              <span id="donate_txt" class="donate_txt">
                   
                        仅仅是一个功能
                   
              </span>
            <br>
        </div>  
  
        <div id="donate_guide" class="donate_bar center hidden">
            <!--
            
                <a href="/WeChat.png" title="支付宝打赏" class="fancybox" rel="article0" 
                    style="float:left;margin-left:25%;margin-right:10px;">
                    <img src="/WeChat.png" title="" height="164px" width="164px">
                </a> 
              

            
                <a href="/WeChat.png" title="微信打赏" class="fancybox" rel="article0"
                    style="margin-right:30%">
                    <img src="/WeChat.png" title="" height="164px" width="164px">
                </a>
            
            -->
            <table>
                <tr>
                    <td>
                        
                            <a href="/WeChat.png" title="支付宝打赏" class="fancybox" rel="article0" 
                                style="float:left;margin-left:25%;margin-right:10px;">
                                <img src="/WeChat.png" title="" height="164px" width="164px">
                            </a> 
                         
                    </td>
                    <td>
                        
                            <a href="/WeChat.png" title="微信打赏" class="fancybox" rel="article0"
                                style="margin-right:30%">
                                <img src="/WeChat.png" title="" height="164px" width="164px">
                            </a>
                        
                    </td>
                </tr>
            </table>

        </div>

        <script type="text/javascript">
            document.getElementById('btn_donate').onclick = function() {
                $('#donate_board').addClass('hidden');
                // $('#donate_guide').removeClass('hidden');
                $('#donate_guide').show(2000);
            }

        </script>
    </div>

    


      
    </div>

    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
  <a class="jiathis_button_tsina"></a>
  <a class="jiathis_button_tqq"></a>
  <a class="jiathis_button_weixin"></a>
  <a class="jiathis_button_cqq"></a>
  <a class="jiathis_button_douban"></a>
  <a class="jiathis_button_renren"></a>
  <a class="jiathis_button_qzone"></a>
  <a class="jiathis_button_kaixin001"></a>
  <a class="jiathis_button_copy"></a>
  <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
  <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
  var jiathis_config={
    hideMore:false
  }
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->

      
    </div>
  </div>

 </div>

        

        
          <div class="comments" id="comments">
            
          </div>
        
      </div>

      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      
	 

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="https://avatars0.githubusercontent.com/u/14291988?s=460&v=4" alt="花花世界" itemprop="image"/>
          <p class="site-author-name" itemprop="name">花花世界</p>
        </div>
        <p class="site-description motion-element" itemprop="description">我思故我在</p>
		
        
        <div id="days"></div>
</script>
<script language="javascript">
function show_date_time(){
window.setTimeout("show_date_time()", 1000);
BirthDay=new Date("12/25/2017 00:00:00");
today=new Date();
timeold=(today.getTime()-BirthDay.getTime());
sectimeold=timeold/1000
secondsold=Math.floor(sectimeold);
msPerDay=24*60*60*1000
e_daysold=timeold/msPerDay
daysold=Math.floor(e_daysold);
e_hrsold=(e_daysold-daysold)*24;
hrsold=setzero(Math.floor(e_hrsold));
e_minsold=(e_hrsold-hrsold)*60;
minsold=setzero(Math.floor((e_hrsold-hrsold)*60));
seconds=setzero(Math.floor((e_minsold-minsold)*60));
document.getElementById('days').innerHTML=daysold+"天"+hrsold+"小时"+minsold+"分";
}
function setzero(i){
if (i<10)
{i="0" + i};
return i;
}
show_date_time();
</script>

        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">29</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">15</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>


<script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
<div class="widget-wrap">
    <div id="myCanvasContainer" class="widget tagcloud">
        <canvas width="250" height="250" id="resCanvas" style="width=100%">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android架构/">Android架构</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android框架/">Android框架</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android源码分析/">Android源码分析</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Camera开发/">Camera开发</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kotlin/">Kotlin</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UI绘制/">UI绘制</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown语法/">markdown语法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/性能优化/">性能优化</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/时光追溯/">时光追溯</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/点滴面试经/">点滴面试经</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/玩转UI/">玩转UI</a><span class="tag-list-count">3</span></li></ul>
        </canvas>
    </div>
</div>


        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        <div class="links-of-friendly motion-element">
          
        </div>

        
        

      </section>

      
        <section class="post-toc-wrap sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Camera-中的方向"><span class="nav-number">2.</span> <span class="nav-text">Camera 中的方向</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Camera-中的尺寸问题"><span class="nav-number">3.</span> <span class="nav-text">Camera 中的尺寸问题</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </section>
      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright" >
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2018
  </span>
  <span class="with-love">
    <i class="icon-next-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">花花世界
  </span>
</div>
<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站总访问量<span id="busuanzi_value_site_uv"></span>次
</span>
</div>
<!--
<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme by <a class="theme-link" href="http://blog.idhyt.com">idhyt</a>.<a class="theme-link" href="https://github.com/idhyt/hexo-theme-next/tree/magiclamp">Mala</a>
</div>
-->
<!-- busuanzi -->

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共46.0k字</span>
</div>

 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    
    

  


  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.1"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.1"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.1" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.1"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.5.1" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 0.4 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    var $tocContent = $('.post-toc-content');
    if (isDesktop() && CONFIG.sidebar === 'post') {
      if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
        displaySidebar();
      }
    }
  });
</script>



  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }
    });
  </script>

  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
  <!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
</body>
</html>
